generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "sqlite"
    url      = env("DATABASE_URL")
}

model User {
    id           String    @id @default(cuid())
    email        String    @unique
    name         String
    passwordHash String
    createdAt    DateTime  @default(now())
    projects     Project[] @relation("OwnerProjects")
    issues       Issue[]   @relation("AssignedIssues")
    comments     Comment[]
    Issue        Issue[]
}

model Project {
    id        String   @id @default(cuid())
    key       String   @unique
    name      String
    owner     User     @relation("OwnerProjects", fields: [ownerId], references: [id])
    ownerId   String
    issues    Issue[]
    createdAt DateTime @default(now())
}

enum IssueStatus {
    TODO
    IN_PROGRESS
    DONE
}

model Issue {
    id          String      @id @default(cuid())
    title       String
    description String
    status      IssueStatus @default(TODO)
    order       Float       @default(0)
    project     Project     @relation(fields: [projectId], references: [id])
    projectId   String
    reporter    User        @relation(fields: [reporterId], references: [id])
    reporterId  String
    assignee    User?       @relation("AssignedIssues", fields: [assigneeId], references: [id])
    assigneeId  String?
    comments    Comment[]
    createdAt   DateTime    @default(now())
    updatedAt   DateTime    @updatedAt
}

model Comment {
    id        String   @id @default(cuid())
    body      String
    issue     Issue    @relation(fields: [issueId], references: [id])
    issueId   String
    author    User     @relation(fields: [authorId], references: [id])
    authorId  String
    createdAt DateTime @default(now())
}
